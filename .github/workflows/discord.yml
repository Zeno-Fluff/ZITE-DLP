name: Discord Notification

on:
  push:
    branches:
      - main
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord message for push
        if: github.event_name == 'push'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{\"content\": \"ZITE DLP-\nğŸ› ï¸ New push to *main* by ${{ github.actor }}\nğŸ”— [View Commit](${{ github.event.head_commit.url }})\nğŸ“ Message: ${{ github.event.head_commit.message }}\"}" \
            $DISCORD_WEBHOOK

      - name: Send Discord message for release
        if: github.event_name == 'release'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{\"content\": \"ZITE DLP-\nğŸš€ New release published by ${{ github.actor }}\nğŸ·ï¸ Tag: ${{ github.event.release.tag_name }}\nğŸ“ Name: ${{ github.event.release.name }}\nğŸ”— [View Release](${{ github.event.release.html_url }})\"}" \
            $DISCORD_WEBHOOK
